"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("react"),t=require("@jup-ag/core"),r=require("jsbi");function n(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var o=n(e),u=n(r);const i={INITIALIZE_ERROR:"INITIALIZE_ERROR",ROUTES_ERROR:"ROUTES_ERROR"},a=e.createContext(null);Object.defineProperty(exports,"JUPITER_ERRORS",{enumerable:!0,get:function(){return t.JUPITER_ERRORS}}),Object.defineProperty(exports,"MARKETS_URL",{enumerable:!0,get:function(){return t.MARKETS_URL}}),Object.defineProperty(exports,"TOKEN_LIST_URL",{enumerable:!0,get:function(){return t.TOKEN_LIST_URL}}),exports.Errors=i,exports.JupiterProvider=({onlyDirectRoutes:u,userPublicKey:r,children:n,...s})=>{const[c,l]=e.useState(),[f,R]=e.useState(new Map),[p,d]=e.useState();e.useEffect(()=>{(async()=>{try{d(void 0);var e=await t.Jupiter.load({...s});l(e)}catch(e){throw console.error(e),d(i.INITIALIZE_ERROR),e}})()},Object.values(s)),e.useEffect(()=>{c&&r&&c.setUserPublicKey(r)},[c,r]),e.useEffect(()=>{!async function(){new Map;let e,r=new URL(t.INDEXED_ROUTE_MAP_URL);s.marketUrl&&(r.hostname=new URL(s.marketUrl).hostname);var n=r.toString();e=await t.Jupiter.getRemoteRouteMap({onlyDirectRoutes:u,restrictIntermediateTokens:s.restrictIntermediateTokens},n),R(e)}()},[s.restrictIntermediateTokens,u]);var E=e.useMemo(()=>Array.from(f.keys()),[f]);return o.default.createElement(a.Provider,{value:{jupiter:c,allTokenMints:E,connection:s.connection,cluster:s.cluster,routeCacheDuration:s.routeCacheDuration,routeMap:f,error:p,setError:d,onlyDirectRoutes:u}},n)},exports.useJupiter=({amount:r,inputMint:n,outputMint:s,slippage:c,debounceTime:l=250,swapMode:f=t.SwapMode.ExactIn,enforceSingleTx:R})=>{const p=e.useContext(a),[d,E]=e.useState(!1),[T,I]=e.useState(),[m,w]=e.useState(0),h=e.useRef(m),[M,g,O]=function(t,r){const[n,o]=e.useState(t);return e.useEffect(()=>{const e=setTimeout(()=>{o(t)},r);return()=>{clearTimeout(e)}},[t,r]),n}(o.default.useMemo(()=>[r,n,s],[r.toString(),null==n?void 0:n.toBase58(),null==s?void 0:s.toBase58()]),l),S=e.useRef(0),v=e.useRef(0);if(!p)throw new Error("JupiterProvider is required");const{routeMap:y,allTokenMints:_,jupiter:b,error:x,setError:U,routeCacheDuration:P=0,onlyDirectRoutes:j}=p;e.useEffect(()=>{h.current=-1},[[null==g?void 0:g.toString(),null==O?void 0:O.toString()].sort().join("-"),c]),e.useEffect(()=>{S.current&&(new Date).getTime()-S.current>=P&&(h.current=-1),u.default.greaterThan(M,u.default.BigInt(0))&&m!==h.current&&E(!0)},[m,M,c,g,O,j]),e.useEffect(()=>{if(b)if(u.default.equal(M,u.default.BigInt(0))||x===i.INITIALIZE_ERROR)I(void 0);else if(M&&g&&O&&y){let r=(new Date).getTime();v.current=r,b.computeRoutes({inputMint:g,outputMint:O,amount:M,slippageBps:Math.ceil(100*c),forceFetch:m!==h.current,onlyDirectRoutes:j,swapMode:f,enforceSingleTx:R}).then(({routesInfos:e,cached:t})=>{v.current===r&&(I(e),U(void 0),t||(S.current=(new Date).getTime()))}).catch(e=>{console.error(e),v.current===r&&(I(void 0),U(i.ROUTES_ERROR))}).finally(()=>{v.current===r&&(h.current=m,E(!1))})}},[b,M,g,O,c,m,j,R]);l=e.useCallback(async({wallet:e,routeInfo:t,onTransaction:r,...n})=>{if(x)throw new Error(x);if(!b)throw new Error("Jupiter not initialized");if(!t)throw new Error("Invalid state, impossible to build transaction");const o=(await b.exchange({routeInfo:t,...n}))["execute"];return o({wallet:e,onTransaction:r})},[b]);return{allTokenMints:_,routeMap:y,exchange:l,refresh:()=>{!d&&S.current&&w(e=>e+1)},lastRefreshTimestamp:S.current,loading:d,routes:T,error:x}},exports.useJupiterRouteMap=()=>{var t=e.useContext(a);if(t)return t.routeMap;throw new Error("JupiterProvider is required")},Object.keys(t).forEach(function(e){"default"===e||exports.hasOwnProperty(e)||Object.defineProperty(exports,e,{enumerable:!0,get:function(){return t[e]}})});
//# sourceMappingURL=react-hook.cjs.production.min.js.map
