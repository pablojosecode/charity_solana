"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var React=require("react"),core=require("@jup-ag/core"),JSBI=require("jsbi");function _interopDefaultLegacy(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var React__default=_interopDefaultLegacy(React),JSBI__default=_interopDefaultLegacy(JSBI);const Errors={INITIALIZE_ERROR:"INITIALIZE_ERROR",ROUTES_ERROR:"ROUTES_ERROR"};function useDebounce(t,r){const[e,o]=React.useState(t);return React.useEffect(()=>{const e=setTimeout(()=>{o(t)},r);return()=>{clearTimeout(e)}},[t,r]),e}const JupiterContext=React.createContext(null),JupiterProvider=({onlyDirectRoutes:r,userPublicKey:e,children:t,...o})=>{const[u,n]=React.useState(),[a,c]=React.useState(new Map),[i,s]=React.useState();React.useEffect(()=>{(async()=>{try{s(void 0);var e=await core.Jupiter.load({...o});n(e)}catch(e){throw console.error(e),s(Errors.INITIALIZE_ERROR),e}})()},Object.values(o)),React.useEffect(()=>{u&&e&&u.setUserPublicKey(e)},[u,e]),React.useEffect(()=>{!async function(){new Map;let e=new URL(core.INDEXED_ROUTE_MAP_URL);o.marketUrl&&(e.hostname=new URL(o.marketUrl).hostname);var t=e.toString(),t=await core.Jupiter.getRemoteRouteMap({onlyDirectRoutes:r,restrictIntermediateTokens:o.restrictIntermediateTokens},t);c(t)}()},[o.restrictIntermediateTokens,r]);var l=React.useMemo(()=>Array.from(a.keys()),[a]);return React__default.default.createElement(JupiterContext.Provider,{value:{jupiter:u,allTokenMints:l,connection:o.connection,cluster:o.cluster,routeCacheDuration:o.routeCacheDuration,routeMap:a,error:i,setError:s,onlyDirectRoutes:r}},t)},useJupiterRouteMap=()=>{var e=React.useContext(JupiterContext);if(e)return e.routeMap;throw new Error("JupiterProvider is required")},useJupiter=({amount:e,inputMint:t,outputMint:r,slippage:o,debounceTime:u=250,swapMode:n=core.SwapMode.ExactIn,enforceSingleTx:a})=>{var c=React.useContext(JupiterContext);const[i,s]=React.useState(!1),[l,R]=React.useState(),[f,p]=React.useState(0),d=React.useRef(f),[E,_,I]=useDebounce(React__default.default.useMemo(()=>[e,t,r],[e.toString(),null==t?void 0:t.toBase58(),null==r?void 0:r.toBase58()]),u),T=React.useRef(0),S=React.useRef(0);if(!c)throw new Error("JupiterProvider is required");const{routeMap:m,allTokenMints:w,jupiter:v,error:J,setError:M,routeCacheDuration:g=0,onlyDirectRoutes:h}=c;React.useEffect(()=>{d.current=-1},[[null===_||void 0===_?void 0:_.toString(),null===I||void 0===I?void 0:I.toString()].sort().join("-"),o]),React.useEffect(()=>{T.current&&(new Date).getTime()-T.current>=g&&(d.current=-1),JSBI__default.default.greaterThan(E,JSBI__default.default.BigInt(0))&&f!==d.current&&s(!0)},[f,E,o,_,I,h]),React.useEffect(()=>{if(v)if(JSBI__default.default.equal(E,JSBI__default.default.BigInt(0))||J===Errors.INITIALIZE_ERROR)R(void 0);else if(E&&_&&I&&m){let r=(new Date).getTime();S.current=r,v.computeRoutes({inputMint:_,outputMint:I,amount:E,slippageBps:Math.ceil(100*o),forceFetch:f!==d.current,onlyDirectRoutes:h,swapMode:n,enforceSingleTx:a}).then(({routesInfos:e,cached:t})=>{S.current===r&&(R(e),M(void 0),t||(T.current=(new Date).getTime()))}).catch(e=>{console.error(e),S.current===r&&(R(void 0),M(Errors.ROUTES_ERROR))}).finally(()=>{S.current===r&&(d.current=f,s(!1))})}},[v,E,_,I,o,f,h,a]);u=React.useCallback(async({wallet:e,routeInfo:t,onTransaction:r,...o})=>{if(J)throw new Error(J);if(!v)throw new Error("Jupiter not initialized");if(!t)throw new Error("Invalid state, impossible to build transaction");const u=(await v.exchange({routeInfo:t,...o}))["execute"];return await u({wallet:e,onTransaction:r})},[v]);return{allTokenMints:w,routeMap:m,exchange:u,refresh:()=>{!i&&T.current&&p(e=>e+1)},lastRefreshTimestamp:T.current,loading:i,routes:l,error:J}};Object.defineProperty(exports,"JUPITER_ERRORS",{enumerable:!0,get:function(){return core.JUPITER_ERRORS}}),Object.defineProperty(exports,"MARKETS_URL",{enumerable:!0,get:function(){return core.MARKETS_URL}}),Object.defineProperty(exports,"TOKEN_LIST_URL",{enumerable:!0,get:function(){return core.TOKEN_LIST_URL}}),exports.Errors=Errors,exports.JupiterProvider=JupiterProvider,exports.useJupiter=useJupiter,exports.useJupiterRouteMap=useJupiterRouteMap,Object.keys(core).forEach(function(e){"default"===e||exports.hasOwnProperty(e)||Object.defineProperty(exports,e,{enumerable:!0,get:function(){return core[e]}})});
//# sourceMappingURL=react-hook.cjs.development.js.map
